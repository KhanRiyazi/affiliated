<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description"
        content="Professional Affiliate Link Builder tool to create optimized, trackable affiliate links for Amazon, Canva, and other platforms with UTM parameters." />
    <meta name="keywords"
        content="affiliate marketing, link builder, Amazon Associates, Canva affiliate, UTM builder" />
    <title>Professional Affiliate Link Builder | Portfolio Project</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111827;
            --muted: #94a3b8;
            --text: #e5e7eb;
            --accent: #22d3ee;
            --ok: #10b981;
            --warn: #f59e0b;
            --error: #ef4444;
            --border: #1f2937;
            --highlight: #1e40af;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #0b1220, #0f172a);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #22d3ee, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: var(--muted);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }

        .card {
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        h1,
        h2,
        h3 {
            color: #e2e8f0;
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.3;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }

        h1:after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 1.25rem;
        }

        h3 {
            font-size: 1.25rem;
        }

        p,
        label,
        small,
        li {
            color: var(--muted);
        }

        a {
            text-decoration: none;
            color: var(--accent);
            transition: color 0.2s;
        }

        a:hover {
            color: #67e8f9;
        }

        .row {
            display: grid;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .row {
                grid-template-columns: repeat(3, 1fr);
            }

            .row-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        input,
        select,
        textarea {
            width: 100%;
            background: #0b1220;
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.2);
        }

        .btn {
            cursor: pointer;
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            font-family: inherit;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn.primary {
            background: var(--accent);
            color: #0b1220;
        }

        .btn.primary:hover {
            background: #06b6d4;
            transform: translateY(-1px);
        }

        .btn.ghost {
            background: transparent;
            border: 1px solid #334155;
            color: #e5e7eb;
        }

        .btn.ghost:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: #475569;
        }

        .btn.small {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }

        .cards {
            display: grid;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .product {
            background: #0b1220;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .product:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .product h3 {
            color: #e5e7eb;
            margin: 0 0 0.5rem;
            font-size: 1.1rem;
        }

        .meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }

        .tag {
            font-size: 0.75rem;
            border: 1px solid #334155;
            border-radius: 999px;
            color: #a5b4fc;
            padding: 0.25rem 0.5rem;
            background: rgba(30, 64, 175, 0.1);
        }

        .cta {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .link-preview {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: #020617;
            border-radius: 10px;
            padding: 0.75rem;
            border: 1px dashed #334155;
            font-size: 0.85rem;
            margin: 0.5rem 0;
        }

        .disclosure {
            font-size: 0.85rem;
            color: #cbd5e1;
            border-left: 3px solid var(--warn);
            padding-left: 0.75rem;
            margin-top: 1.5rem;
        }

        .ok {
            color: var(--ok);
        }

        .warn {
            color: var(--warn);
        }

        .error {
            color: var(--error);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(34, 211, 238, 0.1);
            color: var(--accent);
            margin-left: 0.5rem;
        }

        .features {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            margin: 2rem 0;
        }

        .feature {
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .feature h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .feature-icon {
            width: 24px;
            height: 24px;
            color: var(--accent);
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            color: var(--muted);
            font-size: 0.9rem;
        }

        .portfolio-section {
            margin-top: 3rem;
            text-align: center;
        }

        .portfolio-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.75rem 1.25rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .toast.success {
            border-left: 4px solid var(--ok);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.warning {
            border-left: 4px solid var(--warn);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {

            .row,
            .row-2 {
                grid-template-columns: 1fr;
            }

            .cards {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.75rem;
            }
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--panel);
            color: var(--text);
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Documentation section */
        .docs {
            margin-top: 3rem;
        }

        .doc-section {
            margin-bottom: 2rem;
        }

        .doc-section h3 {
            margin-bottom: 0.75rem;
            color: var(--accent);
        }

        .doc-section ul {
            padding-left: 1.5rem;
        }

        .doc-section li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <div class="logo">Affiliate Link Builder</div>
            <p class="tagline">A professional tool to create optimized, trackable affiliate links for Amazon, Canva, and
                other platforms with UTM parameters.</p>
        </header>

        <div class="card">
            <h1>Generate Affiliate Links <span class="badge">PRO</span></h1>
            <p style="margin-bottom: 1.5rem;">Paste a product URL, choose the platform, set your affiliate IDs, and get
                clean, optimized affiliate links with tracking parameters.</p>

            <div class="grid" style="gap: 1rem;">
                <div class="row">
                    <div>
                        <label for="baseUrl">Product URL</label>
                        <input id="baseUrl"
                            placeholder="https://www.amazon.com/dp/B0... or your Canva affiliate link" />
                    </div>
                    <div>
                        <label for="platform">Platform</label>
                        <select id="platform">
                            <option value="amazon">Amazon Associates</option>
                            <option value="canva">Canva Affiliate</option>
                            <option value="generic">Generic Affiliate Link</option>
                            <option value="flipkart">Flipkart Affiliate</option>
                            <option value="ebay">eBay Partner Network</option>
                        </select>
                    </div>
                    <div>
                        <label for="title">Link Title (for card)</label>
                        <input id="title" placeholder="e.g., Premium Wireless Headphones" />
                    </div>
                </div>

                <div class="row">
                    <div>
                        <label for="tag">Affiliate ID/Parameter <span class="tooltip">ℹ️
                                <span class="tooltip-text">For Amazon: yourtag-21 (IN) / yourtag-20 (US)<br>For Generic:
                                    param=value (e.g., ref=username)</span>
                            </span></label>
                        <input id="tag" placeholder="yourtag-21 (Amazon) or param=value (Generic)" />
                    </div>
                    <div>
                        <label for="utmSource">UTM Source (optional)</label>
                        <input id="utmSource" placeholder="pinterest, newsletter, blog, etc." />
                    </div>
                    <div>
                        <label for="utmCampaign">UTM Campaign (optional)</label>
                        <input id="utmCampaign" placeholder="summer_sale, holiday_deals, etc." />
                    </div>
                </div>

                <div class="row">
                    <div>
                        <label for="desc">Short Description (optional)</label>
                        <input id="desc" placeholder="Highlight key benefits or features" />
                    </div>
                    <div>
                        <label for="imageUrl">Image URL (optional)</label>
                        <input id="imageUrl" placeholder="Direct image URL for product card" />
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 0.75rem;">
                        <button class="btn primary" id="build">
                            <span id="buildText">Generate Link</span>
                            <span id="buildSpinner" class="spinner" style="display: none;"></span>
                        </button>
                        <button class="btn ghost" id="copyAll">Copy All</button>
                    </div>
                </div>
            </div>

            <p class="disclosure">
                <strong>Disclosure:</strong> Some links are affiliate links. This means I may earn a commission if you
                click through and make a purchase, at no additional cost to you. Your support helps maintain this tool.
            </p>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Your Generated Links</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn ghost small" id="clearAll">Clear All</button>
                    <button class="btn ghost small" id="exportJson">Export JSON</button>
                </div>
            </div>
            <div id="list" class="cards"></div>
        </div>

        <div class="docs">
            <h2>Documentation</h2>

            <div class="doc-section">
                <h3>How to Use This Tool</h3>
                <ul>
                    <li>Paste any product URL (Amazon, Canva, etc.) in the Product URL field</li>
                    <li>Select the appropriate platform from the dropdown</li>
                    <li>Enter your affiliate ID or parameter (Amazon tag, ref code, etc.)</li>
                    <li>Add optional UTM parameters for tracking</li>
                    <li>Click "Generate Link" to create your optimized affiliate link</li>
                    <li>Copy individual links or export all links as JSON</li>
                </ul>
            </div>

            <div class="doc-section">
                <h3>Platform-Specific Instructions</h3>
                <ul>
                    <li><strong>Amazon Associates:</strong> Enter your full Associate tag (e.g., yourtag-21 for India,
                        yourtag-20 for US)</li>
                    <li><strong>Canva Affiliate:</strong> Paste your exact Canva affiliate link as provided in your
                        dashboard</li>
                    <li><strong>Generic Affiliate Links:</strong> Use format "param=value" (e.g., "ref=yourusername" or
                        "aff_id=12345")</li>
                    <li><strong>Flipkart Affiliate:</strong> Use your Flipkart affiliate ID in the parameter field</li>
                    <li><strong>eBay Partner Network:</strong> Enter your eBay campaign ID</li>
                </ul>
            </div>

            <div class="doc-section">
                <h3>Best Practices</h3>
                <ul>
                    <li>Always disclose affiliate relationships to your audience</li>
                    <li>Use descriptive UTM parameters for better tracking</li>
                    <li>Test links before publishing to ensure they work correctly</li>
                    <li>Regularly check your affiliate dashboard for performance metrics</li>
                    <li>Rotate UTM campaigns to identify top-performing channels</li>
                </ul>
            </div>
        </div>

        <div class="features">
            <div class="feature">
                <h3><svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg> Fast Link Generation</h3>
                <p>Create optimized affiliate links in seconds with automatic parameter insertion and validation.</p>
            </div>
            <div class="feature">
                <h3><svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg> Secure & Reliable</h3>
                <p>All processing happens in your browser. No data is stored on any server for maximum privacy.</p>
            </div>
            <div class="feature">
                <h3><svg class="feature-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                        </path>
                    </svg> Multi-Platform Support</h3>
                <p>Works with Amazon, Canva, Flipkart, eBay, and any generic affiliate program.</p>
            </div>
        </div>

        <div class="portfolio-section">
            <h2>Portfolio Project</h2>
            <p>This Affiliate Link Builder was developed as part of my professional portfolio to demonstrate front-end
                development skills and affiliate marketing expertise.</p>
            <a href="./main.html" class="btn primary portfolio-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 0 1-9 9H9a9 9 0 0 1-9-9 9 9 0 0 1 9-9h3"></path>
                    <polyline points="21 12 12 12 12 3"></polyline>
                </svg>
                View My Portfolio
            </a>
        </div>

        <footer>
            <p>© 2023 Professional Affiliate Link Builder. All rights reserved.</p>
            <p style="margin-top: 0.5rem;">Designed and developed with ❤️ for affiliate marketers worldwide.</p>
        </footer>
    </div>

    <script>
        (function () {
            // DOM elements
            const $ = s => document.querySelector(s);
            const $$ = s => document.querySelectorAll(s);
            const list = $("#list");
            const buildBtn = $("#build");
            const buildText = $("#buildText");
            const buildSpinner = $("#buildSpinner");

            // State management
            let links = JSON.parse(localStorage.getItem('affiliateLinks')) || [];

            // Initialize the app
            function init() {
                renderLinks();
                setupEventListeners();
            }

            // Set up event listeners
            function setupEventListeners() {
                $("#build").addEventListener("click", generateLink);
                $("#copyAll").addEventListener("click", copyAllLinks);
                $("#clearAll").addEventListener("click", clearAllLinks);
                $("#exportJson").addEventListener("click", exportLinksAsJson);

                // Platform-specific guidance
                $("#platform").addEventListener("change", function () {
                    const platform = this.value;
                    updatePlaceholderText(platform);
                });

                // Load any saved links
                if (links.length > 0) {
                    showToast(`Loaded ${links.length} saved links`, 'success');
                }
            }

            // Update input placeholder based on platform
            function updatePlaceholderText(platform) {
                const tagInput = $("#tag");

                switch (platform) {
                    case 'amazon':
                        tagInput.placeholder = 'yourtag-21 (IN) / yourtag-20 (US)';
                        break;
                    case 'canva':
                        tagInput.placeholder = 'Paste your exact Canva affiliate link';
                        break;
                    case 'generic':
                        tagInput.placeholder = 'param=value (e.g., ref=username)';
                        break;
                    case 'flipkart':
                        tagInput.placeholder = 'Your Flipkart affiliate ID';
                        break;
                    case 'ebay':
                        tagInput.placeholder = 'Your eBay campaign ID';
                        break;
                    default:
                        tagInput.placeholder = 'Enter affiliate parameter';
                }
            }

            // Parse URL with validation
            function parseURL(url) {
                try {
                    const u = new URL(url);

                    // Ensure URL has http/https protocol
                    if (!u.protocol.match(/^https?:$/)) {
                        throw new Error('URL must start with http:// or https://');
                    }

                    return u;
                } catch (e) {
                    showToast('Invalid URL. Please include http:// or https://', 'error');
                    return null;
                }
            }

            // Add or update URL parameter
            function addOrUpdateParam(urlObj, key, value) {
                if (!value) return false;

                const hasParam = urlObj.searchParams.has(key);
                urlObj.searchParams.set(key, value.trim());
                return hasParam;
            }

            // Check if host is Amazon
            function isAmazonHost(host) {
                return /\.amazon\.(com|co\.uk|de|fr|it|es|ca|com\.mx|com\.br|com\.au|in|jp|cn|sa|sg|ae|se|nl|pl|tr)/i.test(host);
            }

            // Check if host is Flipkart
            function isFlipkartHost(host) {
                return /\.flipkart\.com/i.test(host);
            }

            // Check if host is eBay
            function isEbayHost(host) {
                return /\.ebay\.(com|co\.uk|de|fr|it|es|ca|com\.au|at|be|ch|ie|nl|ph|sg|my|vn|hk)/i.test(host);
            }

            // Build Amazon affiliate link
            function buildAmazon(urlObj, tag) {
                if (!tag) {
                    throw new Error('Amazon Associate tag is required (e.g., yourtag-21)');
                }

                // Validate Amazon tag format
                if (!tag.match(/^[a-zA-Z0-9\-]+-\d{2}$/)) {
                    throw new Error('Amazon tag should be in format: yourtag-20 or yourtag-21');
                }

                addOrUpdateParam(urlObj, 'tag', tag);

                // Remove competing affiliate parameters
                urlObj.searchParams.delete('ascsubtag');
                urlObj.searchParams.delete('ascsubtag');

                return urlObj.toString();
            }

            // Build Canva affiliate link
            function buildCanva(urlObj) {
                // Validate it's a Canva link
                if (!urlObj.hostname.includes('canva.com')) {
                    showToast('This doesn\'t look like a Canva link. Use your exact affiliate link from Canva.', 'warning');
                }

                return urlObj.toString();
            }

            // Build Flipkart affiliate link
            function buildFlipkart(urlObj, affiliateId) {
                if (!affiliateId) {
                    throw new Error('Flipkart affiliate ID is required');
                }

                addOrUpdateParam(urlObj, 'affid', affiliateId);
                return urlObj.toString();
            }

            // Build eBay affiliate link
            function buildEbay(urlObj, campaignId) {
                if (!campaignId) {
                    throw new Error('eBay campaign ID is required');
                }

                addOrUpdateParam(urlObj, 'campid', campaignId);
                return urlObj.toString();
            }

            // Build generic affiliate link
            function buildGeneric(urlObj, paramKV) {
                if (paramKV && paramKV.includes('=')) {
                    const [k, v] = paramKV.split('=');
                    addOrUpdateParam(urlObj, k.trim(), v.trim());
                } else if (paramKV) {
                    // Default to 'ref' parameter if no = is provided
                    addOrUpdateParam(urlObj, 'ref', paramKV.trim());
                }

                return urlObj.toString();
            }

            // Apply UTM parameters
            function applyUTM(urlStr, source, campaign) {
                const u = new URL(urlStr);

                if (source) addOrUpdateParam(u, 'utm_source', source);
                if (campaign) addOrUpdateParam(u, 'utm_campaign', campaign);

                // Set medium to affiliate by default
                addOrUpdateParam(u, 'utm_medium', 'affiliate');

                return u.toString();
            }

            // Create product card HTML
            function createCard({ title, url, desc, platform, imageUrl }) {
                const card = document.createElement('div');
                card.className = 'product';

                const safeTitle = title || 'Affiliate Link';
                const safeDesc = desc || '';
                const safeImage = imageUrl ? `<img src="${escapeHTML(imageUrl)}" alt="${escapeHTML(safeTitle)}" style="max-width:100%; border-radius:8px; margin-bottom:0.75rem;">` : '';

                card.innerHTML = `
                ${safeImage}
                <h3>${escapeHTML(safeTitle)}</h3>
                <div class="meta">
                    <span class="tag">${escapeHTML(platform)}</span>
                    <span class="tag">nofollow</span>
                    <span class="tag">sponsored</span>
                </div>
                <p style="margin:0.5rem 0;color:#cbd5e1">${escapeHTML(safeDesc)}</p>
                <div class="link-preview" title="${escapeHTML(url)}">${escapeHTML(url)}</div>
                <div class="cta">
                    <a class="btn primary" href="${escapeHTML(url)}" target="_blank" rel="nofollow sponsored noopener">View Offer</a>
                    <button class="btn ghost copy">Copy Link</button>
                    <button class="btn ghost small delete">Delete</button>
                    <small style="color:#94a3b8">Opens in new tab • No underline</small>
                </div>
            `;

                // Add event listeners to buttons
                card.querySelector('.copy').addEventListener('click', async () => {
                    await navigator.clipboard.writeText(url);
                    showToast('Link copied to clipboard ✓', 'success');
                });

                card.querySelector('.delete').addEventListener('click', () => {
                    deleteLink(url);
                    card.remove();
                    showToast('Link deleted', 'error');
                });

                return card;
            }

            // Delete a link from state
            function deleteLink(url) {
                links = links.filter(link => link.url !== url);
                saveLinks();
            }

            // Clear all links
            function clearAllLinks() {
                if (!links.length) {
                    showToast('No links to clear', 'warning');
                    return;
                }

                if (confirm('Are you sure you want to delete all generated links?')) {
                    links = [];
                    saveLinks();
                    list.innerHTML = '';
                    showToast('All links cleared', 'error');
                }
            }

            // Copy all links to clipboard
            async function copyAllLinks() {
                if (!links.length) {
                    showToast('No links to copy', 'warning');
                    return;
                }

                const linkText = links.map(link => `${link.title}: ${link.url}`).join('\n\n');

                try {
                    await navigator.clipboard.writeText(linkText);
                    showToast(`${links.length} links copied to clipboard ✓`, 'success');
                } catch (err) {
                    showToast('Failed to copy links', 'error');
                    console.error(err);
                }
            }

            // Export links as JSON
            function exportLinksAsJson() {
                if (!links.length) {
                    showToast('No links to export', 'warning');
                    return;
                }

                const dataStr = JSON.stringify(links, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

                const exportName = `affiliate-links-${new Date().toISOString().slice(0, 10)}.json`;

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportName);
                linkElement.click();

                showToast(`Exported ${links.length} links as JSON ✓`, 'success');
            }

            // Save links to localStorage
            function saveLinks() {
                localStorage.setItem('affiliateLinks', JSON.stringify(links));
            }

            // Render all links
            function renderLinks() {
                list.innerHTML = '';

                if (links.length === 0) {
                    list.innerHTML = '<p style="color:var(--muted); grid-column:1/-1; text-align:center;">No links generated yet. Create your first affiliate link above.</p>';
                    return;
                }

                // Sort by newest first
                const sortedLinks = [...links].reverse();

                sortedLinks.forEach(link => {
                    const card = createCard(link);
                    list.appendChild(card);
                });
            }

            // Show toast notification
            function showToast(msg, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = msg;

                // Add icon based on type
                let icon = '';
                if (type === 'success') {
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
                } else if (type === 'error') {
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
                } else {
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
                }

                toast.innerHTML = `${icon} ${msg}`;

                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            // Escape HTML for safe rendering
            function escapeHTML(s) {
                if (!s) return '';
                return s.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
            }

            // Generate affiliate link
            async function generateLink() {
                const baseUrl = $("#baseUrl").value.trim();
                const platform = $("#platform").value;
                const title = $("#title").value.trim();
                const desc = $("#desc").value.trim();
                const tag = $("#tag").value.trim();
                const utmS = $("#utmSource").value.trim();
                const utmC = $("#utmCampaign").value.trim();
                const imageUrl = $("#imageUrl").value.trim();

                // Validate inputs
                if (!baseUrl) {
                    showToast('Please enter a product URL', 'error');
                    $("#baseUrl").focus();
                    return;
                }

                // Show loading state
                buildText.textContent = 'Generating...';
                buildSpinner.style.display = 'inline-block';

                // Small delay to show loading state
                await new Promise(resolve => setTimeout(resolve, 300));

                try {
                    const u = parseURL(baseUrl);
                    if (!u) return;

                    let finalUrl;
                    let detectedPlatform = platform;

                    // Auto-detect platform if generic is selected but URL matches known platforms
                    if (platform === 'generic') {
                        if (isAmazonHost(u.host)) {
                            detectedPlatform = 'amazon';
                        } else if (isFlipkartHost(u.host)) {
                            detectedPlatform = 'flipkart';
                        } else if (isEbayHost(u.host)) {
                            detectedPlatform = 'ebay';
                        } else if (u.host.includes('canva.com')) {
                            detectedPlatform = 'canva';
                        }
                    }

                    // Build URL based on platform
                    switch (detectedPlatform) {
                        case 'amazon':
                            finalUrl = buildAmazon(u, tag || 'YOURTAG-21');
                            break;
                        case 'canva':
                            finalUrl = buildCanva(u);
                            break;
                        case 'flipkart':
                            finalUrl = buildFlipkart(u, tag);
                            break;
                        case 'ebay':
                            finalUrl = buildEbay(u, tag);
                            break;
                        default:
                            finalUrl = buildGeneric(u, tag);
                    }

                    // Apply UTM parameters
                    finalUrl = applyUTM(finalUrl, utmS, utmC);

                    // Create link object
                    const link = {
                        title: title || 'Affiliate Link',
                        url: finalUrl,
                        desc: desc,
                        platform: detectedPlatform,
                        imageUrl: imageUrl,
                        createdAt: new Date().toISOString()
                    };

                    // Add to state and save
                    links.push(link);
                    saveLinks();

                    // Render the new link
                    const card = createCard(link);
                    list.prepend(card);

                    // Clear the "no links" message if it exists
                    if (links.length === 1) {
                        renderLinks();
                    }

                    showToast('Affiliate link generated ✓', 'success');

                } catch (err) {
                    console.error(err);
                    showToast(err.message || 'Error generating link', 'error');
                } finally {
                    // Reset loading state
                    buildText.textContent = 'Generate Link';
                    buildSpinner.style.display = 'none';
                }
            }

            // Initialize the application
            init();
        })();
    </script>
</body>

</html>